#modaldecl.modal.fade{"aria-labelledby" => "nuevoLabel", :role => "dialog", :tabindex => "-1"}
  .modal-dialog.modal-xs{:role => "document"}
    .modal-content
      .modal-header
        %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
          %span{"aria-hidden" => "true"} &times;
        %h4#nuevoLabel.modal-title= t('.new_declaracion')
      = form_for @declaracion, url: { action: actionvar } do |f|
        = hidden_field_tag :tags_ids
        .modal-body
          .row
            .col-md-4#first-column
              .input-group
                = f.label t('.index'), { class: "input-group-addon", id: "basic-addon1"}
                = f.text_field :letra, { class: "form-control", "aria-describedby": "basic-addon1", :placeholder => t('.letter'), type: :text }
                = f.text_field :nro, { class: "form-control", "aria-describedby": "basic-addon1", :placeholder => t('.number'), type: :number }
                = f.text_field :bis, { class: "form-control", "aria-describedby": "basic-addon1", :placeholder => t('.bis'), type: :number }
              .input-group
                = f.label t('.description'), { class: "input-group-addon", id: "basic-addon3"}
                = f.text_area :descripcion, {class: "form-control", "aria-describedby" => "basic-addon3", :placeholder => t('.description'), type: :text}
              .input-group
                = f.label :sumario, { class: "input-group-addon", id: "basic-addon2"}
                = f.text_area :sumario, {class: "form-control", "aria-describedby" => "basic-addon2", :placeholder => t('.summary'), type: :text}
              .input-group
                = f.label :sancion, { class: "input-group-addon", id: "basic-addon4"}
                = f.text_field :sancion, {class: "form-control", "aria-describedby" => "basic-addon4", type: :date}
              .input-group
                = f.label t('.validate_entry'), { class: "input-group-addon", id: "basic-addon5"}
                = f.text_field :entrada_vigencia, {class: "form-control", "aria-describedby" => "basic-addon5", type: :date }
              .input-group
                = f.label t('.validate_output'), { class: "input-group-addon",id: "basic-addon6"}
                = f.text_field :finaliza_vigencia, {class: "form-control", "aria-describedby" => "basic-addon6", type: :date }
                = f.text_field :plazo_dia, {class: "form-control", "aria-describedby" => "basic-addon6",:placeholder => t('.deadline_day'), type: :number }
                = f.text_field :plazo_mes, {class: "form-control", "aria-describedby" => "basic-addon6",:placeholder => t('.deadline_month'), type: :number }
                = f.text_field :plazo_anio, {class: "form-control", "aria-describedby" => "basic-addon6",:placeholder => t('.deadline_year'), type: :number }
              .input-group
                = f.label t('.organism'), { class: "input-group-addon", id: "basic-addon10"}
                = f.text_field :organismo_origen, {class: "form-control", "aria-describedby" => "basic-addon10", :placeholder => t('.organism'), type: :text }
              .input-group
                = f.label t('.tags'), { class: "input-group-addon", id: "basic-addon13" }
                %input#tags-tokeninput.form-control{"aria-describedby" => "basic-addon13", type: :text, data: { load: prepopulate_tags(@declaracion) } }
            .col-md-8
              .group-buttons
                %button#classify.btn.btn-default{:type => "button"}
                  %i.fa.fa-check-square-o
                  = t('.btn_clasification.classify')
                %button#dates.btn.btn-default{:type => "button"}
                  %i.fa.fa-calendar-plus-o
                  = t('.btn_clasification.dates')
              .dates
                .input-group
                  = f.label "Comunicación", { class: "input-group-addon", id: "basic-addon18"}
                  .input-group
                    = f.label "Fecha", {class: "input-group-addon", id: "basic-addon19"}
                    .input-group
                      = f.text_field :com_date, {class: "form-control", "aria-describedby" => "basic-addon19", type: :date }
                  .input-group
                    = f.label "Destino", {class: "input-group-addon", id: "basic-addon20"}
                    .input-group
                      = f.text_field :com_dest, {class: "form-control", "aria-describedby" => "basic-addon20", type: :text }
                .input-group
                  = f.label "Notificación", { class: "input-group-addon", id: "basic-addon21"}
                  .input-group
                    = f.label "Fecha", {class: "input-group-addon", id: "basic-addon22"}
                    .input-group
                      = f.text_field :not_date, {class: "form-control", "aria-describedby" => "basic-addon22", type: :date }
                  .input-group
                    = f.label "Destino", {class: "input-group-addon", id: "basic-addon23"}
                    .input-group
                      = f.text_field :not_dest, {class: "form-control", "aria-describedby" => "basic-addon23", type: :text }
                .input-group
                  = f.label "Publicacion", { class: "input-group-addon", id: "basic-addon24"}
                  .input-group.form-control
                    Completar publicación
                .group-buttons2
                  %button#ready.btn.btn-success{:type => "button"}= t('.btn_clasification.ready')
              .clasification
                .input-group
                  = f.label "Contenido", { class: "input-group-addon", id: "basic-addon14"}
                  .input-group.form-control
                    = check_box_tag 'general', nil ,search_value_classify('General',@declaracion.id)
                    = label_tag 'general', 'General'
                    &nbsp
                    = check_box_tag 'autonomo', nil ,search_value_classify('Autónomo',@declaracion.id)
                    = label_tag 'autonomo', 'Autónomo'
                  .input-group
                    = f.label "Particular", {class: "input-group-addon", id: "basic-addon15"}
                    .input-group.form-control
                      = check_box_tag 'individual', nil ,search_value_classify('Individual y meros actos administrativos',@declaracion.id)
                      = label_tag 'individual', 'Individual y meros actos administrativos'
                    .input-group
                      = f.label "Contrataciones y convenios", {class: "input-group-addon", id: "basic-addon16"}
                      .input-group.form-control
                        = check_box_tag 'servicios_public', nil ,search_value_classify('De Servicios Públicos',@declaracion.id)
                        = label_tag 'servicios_public', 'De Servicios Públicos'
                        &nbsp
                        = check_box_tag 'Otras', nil ,search_value_classify('Otras',@declaracion.id)
                        = label_tag 'Otras', 'Otras'
                  .input-group
                    = f.label "Alcance", {class: "input-group-addon", id: "basic-addon16"}
                    .input-group.form-control
                      = check_box_tag 'general', nil ,search_value_classify('Alcance general',@declaracion.id)
                      = label_tag 'general', 'Alcance general'
                      &nbsp
                      = check_box_tag 'especial', nil ,search_value_classify('Alcance especial',@declaracion.id)
                      = label_tag 'especial', 'Alcance especial'
                .input-group
                  = f.label "Vigencia", { class: "input-group-addon", id: "basic-addon14"}
                  .input-group.form-control
                    = check_box_tag 'dictada', nil ,search_value_classify('Dictada por razones de emergencia',@declaracion.id)
                    = label_tag 'dictada', 'Dictada por razones de emergencia'
                    &nbsp
                    = check_box_tag 'dictada', nil ,search_value_classify('De necesidad o urgencia',@declaracion.id)
                    = label_tag 'dictada', 'De necesidad o urgencia'
                    &nbsp
                    = check_box_tag 'referendum', nil ,search_value_classify('Dictado ad referendum',@declaracion.id)
                    = label_tag 'referendum', 'Dictado ad referendum'
                  .input-group
                    = f.label "De renovación períodica", {class: "input-group-addon", id: "basic-addon15"}
                    .input-group.form-control
                      = check_box_tag 'contiene', nil ,search_value_classify('Que contienen normas generales y permanentes',@declaracion.id)
                      = label_tag 'contiene', 'Que contienen normas generales y permanentes'
                      &nbsp
                      = check_box_tag 'contiene', nil ,search_value_classify('Que NO contienen normas generales y permanentes',@declaracion.id)
                      = label_tag 'contiene', 'Que NO contienen normas generales y permanentes'
                  .input-group
                    = f.label "Motivos", {class: "input-group-addon", id: "basic-addon16"}
                    .input-group.form-control
                      = check_box_tag 'subsisten', nil ,search_value_classify('Motivos subsisten',@declaracion.id)
                      = label_tag 'subsisten', 'Motivos subsisten'
                    .input-group
                      = f.label "No subsisten", {class: "input-group-addon", id: "basic-addon17"}
                      .input-group.form-control
                        = check_box_tag 'generales', nil ,search_value_classify('Normas generales',@declaracion.id)
                        = label_tag 'generales', 'Normas generales'
                        &nbsp
                        = check_box_tag 'no-generales', nil ,search_value_classify('Normas no generales',@declaracion.id)
                        = label_tag 'no-generales', 'Normas no generales'
                  .input-group.form-control
                    = check_box_tag 'plazo-cumplido', nil ,search_value_classify('Plazo determinado y cumplido',@declaracion.id)
                    = label_tag 'plazo-cumplido', 'Plazo determinado y cumplido'
                    &nbsp
                    = check_box_tag 'no-cumplido', nil ,search_value_classify('Plazo determinado y NO cumplido',@declaracion.id)
                    = label_tag 'no-cumplido', 'Plazo determinado y NO cumplido'
                  .input-group.form-control
                    = check_box_tag 'vigencia-sujeta', nil ,search_value_classify('Vigencia sujeta a condición resolutoria',@declaracion.id)
                    = label_tag 'vigencia', 'Vigencia sujeta a condición resolutoria'
                  .input-group.form-control
                    = check_box_tag 'cumplida', nil ,search_value_classify('Cumplida',@declaracion.id)
                    = label_tag 'cumplida', 'Cumplida'
                    &nbsp
                    = check_box_tag 'no-cumplida', nil ,search_value_classify('NO cumplida',@declaracion.id)
                    = label_tag 'no-cumplida', 'NO cumplida'
                    &nbsp
                    = check_box_tag 'agotado', nil ,search_value_classify('Objeto agotado',@declaracion.id)
                    = label_tag 'agotado', 'Objeto agotado'
                .input-group
                  = f.label "Derogación", { class: "input-group-addon", id: "basic-addon16"}
                  .input-group.form-control
                    = check_box_tag 'derog-susp', nil ,search_value_classify('Derogación sujeta a condición suspensiva',@declaracion.id)
                    = label_tag 'derog-susp', 'Derogación sujeta a condición suspensiva'
                    &nbsp
                  .input-group.form-control
                    = check_box_tag 'derog-tacita', nil ,search_value_classify('Derog. tácita',@declaracion.id)
                    = label_tag 'derog-tacita', 'Derog. tácita'
                    &nbsp
                    = check_box_tag 'derog-cumplida', nil ,search_value_classify('Derog. cumplida',@declaracion.id)
                    = label_tag 'derog-cumplida', 'Derog. cumplida'
                    &nbsp
                    = check_box_tag 'derog-no-cumplida', nil ,search_value_classify('Derog. NO cumplida',@declaracion.id)
                    = label_tag 'derog-no-cumplida', 'Derog. NO cumplida'
                    &nbsp
                .group-buttons2
                  %button#ready.btn.btn-success{:type => "button"}= t('.btn_clasification.ready')
              #second-column
                .input-group
                  = f.label t('.observations'), { class: "input-group-addon", id: "basic-addon7"}
                  = f.text_area :observaciones, {class: "form-control", "aria-describedby" => "basic-addon7", :placeholder => t('.observations'), type: :text }
                .input-group
                  = f.label :expedientes, { class: "input-group-addon", id: "basic-addon8" }
                  = f.text_field :expedientes, { class: "form-control", "aria-describedby": "basic-addon8", id: "exped_token",
                                                 type: "text", data: { load: prepopulate_exps(@declaracion) }}
                .input-group
                  = f.label t('.norma_disp'), { class: "input-group-addon", id: "basic-addon9"}
                  = select_tag :refer_type, options_for_select(refers_type), { class: "form-control", "aria-describedby": "basic-addon9"}
                  .input-group
                    = f.label t('.destiny'), { class: "input-group-addon", id: "basic-addon13"}
                    %input#norma.form-control{"aria-describedby" => "basic-addon13", type: :text }
                  .input-group
                    = f.label t('.from'), { class: "input-group-addon", id: "basic-addon12"}
                    %input#from_refer.form-control{"aria-describedby" => "basic-addon12", type: :date }
                    .input-group-addon
                      %label
                        %input{:checked => "checked",:name => "tipo_dia", :type => "radio", :value => "0"}
                        = t('.not_clear')
                        &nbsp
                      %label
                        %input{:name => "tipo_dia", :type => "radio", :value => "1"}
                        = t('.working_day')
                        &nbsp
                      %label
                        %input{:name => "tipo_dia", :type => "radio", :value => "2"}
                        = t('.calendar_day')
                        &nbsp
                  .input-group
                    = f.label t('.to'), { class: "input-group-addon",id: "basic-addon11"}
                    %input#to_refer.form-control{"aria-describedby" => "basic-addon11", type: :date }
                    %input#day_refer.form-control{"aria-describedby" => "basic-addon11",:placeholder => t('.deadline_day'), type: :number }
                    %input#month_refer.form-control{"aria-describedby" => "basic-addon11",:placeholder => t('.deadline_month'), type: :number }
                    %input#year_refer.form-control{"aria-describedby" => "basic-addon11",:placeholder => t('.deadline_year'), type: :number }
                  .input-group-addon
                    %i.fa.fa-plus-circle.fa-2x#add_disp
                #disp_norma_table
                  .row
                    .col-xs-12
                      %table.table.table-striped.table-bordered#table-link
                        %thead
                          %tr
                            %th= t('.table.ref_type')
                            %th= t('.table.destiny')
                            %th= t('.table.date')
                            %th{width: "1%"}= icon 'trash', '', class: 'fa-1x'
                        %tbody
                          - @declaracion.relationship_modificadas.each do |x|
                            %tr
                              %td= x.tipo_relacion
                              %td= indice x
                              %td= "Dates"
                              %td= icon 'fa fa-times', nil, class: 'btn btn-xs remove-tr'
        .modal-footer
          = f.submit "Guardar", {class: "btn btn-primary modal-submit"}

:javascript
  wi = $(window).width()-20;
  margin = 10;
  $(".modal-xs").css('width', wi);
  $(".modal-xs").css('margin-left', margin);

  $('#exped_token').tokenInput('/declaracions/search_exp', {
    preventDuplicates: true,
    propertyToSearch: 'indice',
    theme: 'bootstrap',
    zindex: 1050,
    hintText: "#{t 'tokeninput.hint.enter_exp'}",
    resultsFormatter: function(exp) {
      return '<li><p style= \'color: black\'> Exp: ' + exp.indice + '</p></li>';
    },
    tokenFormatter: function(exp) {
      return '<li><p> Exp: ' + exp.indice + '</p></li>';
    },
    allowTabOut: true,
    placeholder: "#{ I18n.t('tokeninput.placeholder.exp_example') }"
  });

  $('#tags-tokeninput').tokenInput('/declaracions/search_tag', {
    preventDuplicates: true,
    propertyToSearch: 'nombre',
    theme: 'bootstrap',
    zindex: 1050,
    hintText: "#{ I18n.t('tokeninput.placeholder.tag_example') }",
    tokenFormatter: function(tag) {
      return "<li><p class='tags-token' data-id='" + tag.id + "' style='color: black'> " + tag.nombre + "</p></li>";
    },
    resultsFormatter: function(tag) {
      return '<li><p>' + tag.nombre + '</p></li>';
    },
    allowTabOut: true,
    placeholder: "#{ I18n.t('tokeninput.placeholder.tag') }"
  });

  $('#norma').tokenInput('/declaracions/search_norma', {
    preventDuplicates: true,
    propertyToSearch: 'indice',
    theme: 'bootstrap',
    zindex: 1050,
    hintText: "#{ I18n.t('tokeninput.hint.enter_norma') }",
    resultsFormatter: function(norma) {
      return '<li><p style= \'color: black\'> ' + norma.indice + '</p></li>';
    },
    tokenFormatter: function(norma) {
      return '<li><p> ' + norma.indice + '</p></li>';
    },
    allowTabOut: true,
    placeholder: "#{ I18n.t('tokeninput.placeholder.norma_example') }",
    onAdd: function(norma){
      vinculada = false
      $('#table-link > tbody  > tr').each(function() {
        n = norma.indice.trim();
        td = $(this).children(':nth-child(2)').text().trim();
        vinculada = (td == n);
        if (vinculada){
          $('#norma').tokenInput('remove', norma);
          alert(n + " ya esta vinculada/o");
        }
      });
    }
  });

  $(document).on('click', '.modal-submit', function(event) {
    event.preventDefault();
    var tagsIds = []
    $(".tags-token").each(function(key, value) {
      tagsIds.push($(value).data("id"))
    })
    $("#tags_ids").val(tagsIds);
    $("#new_declaracion").submit();
  });
