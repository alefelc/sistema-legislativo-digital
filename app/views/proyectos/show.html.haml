- fojas = @proyecto.get_fojas
- asunto = @proyecto.get_asunto
- iniciadores_organos = get_iniciadores_organos(@proyecto)
- iniciadores_areas = get_iniciadores_areas(@proyecto)
- iniciadores_reparticiones = get_iniciadores_reparticiones(@proyecto)
- iniciadores_dependencias = get_iniciadores_dependencias(@proyecto)
- iniciadores_bloques = get_iniciadores_bloques(@proyecto)
- iniciadores_comisions = get_iniciadores_comisions(@proyecto)
- iniciadores_persons = get_iniciadores_persons(@proyecto)
- obs = @proyecto.get_observaciones

#proyecto-show

  #proyecto-header.row
    .col-md-8
      %h3.main-title= t('proyectos.show.info') + " #{ @proyecto.id }"
    .col-md-4.float-right.no-print
      .float-right
        %a.btn.btn-lg.btn-danger.fa.fa-download#print-proyecto{ title: 'Imprimir Proyecto' }
          Imprimir
        %a.btn.btn-lg.btn-primary.fa.fa-download{ title: 'Descargar Proyecto' }
          Descargar

  #proyecto-body
    .panel.panel-success
      .panel-heading Información
      .panel-body

        %p.single-tab
          %span.titles Nro. de Fojas:
          %span= fojas.present? ? fojas : '-.'

        %p.single-tab
          %span.titles.titles Asunto:
          %span= asunto.present? ? asunto : '-.'

    .panel.panel-info
      .panel-heading Trámites del Proyecto
      .panel-body.without-padding
        %table.table.table-striped#states-table-proyecto-show
          %thead
            %tr
              %th.center{ width: '15%' }= 'Fecha'
              %th{ width: '85%' }= 'Estado'
          %tbody
            - @proyecto.estado_tramites.each do |x|
              - case x.tipo
              - when '1'
                %tr.derivacion-tr-show{ 'data-id': x.id, 'data-tipo': x.tipo }
                  %td= to_date x.created_at
                  %td
                    Iniciado por:
                    %p.single-tab
                      - iniciadores_organos.each do |o|
                        .double-tab{ style: 'display: flex' }
                          = o[:denominacion].to_s
                          %p &nbsp;
                          .subtitle (Órgano de Gobierno)
                      - iniciadores_areas.each do |a|
                        .double-tab{ style: 'display: flex' }
                          = a[:denominacion].to_s
                          %p &nbsp;
                          .subtitle (Área)
                      - iniciadores_bloques.each do |b|
                        .double-tab{ style: 'display: flex' }
                          = b[:denominacion].to_s
                          %p &nbsp;
                          .subtitle (Bloque)
                      - iniciadores_comisions.each do |b|
                        .double-tab{ style: 'display: flex' }
                          = b[:denominacion].to_s
                          %p &nbsp;
                          .subtitle (Comisión)
                      - iniciadores_reparticiones.each do |r|
                        .double-tab{ style: 'display: flex' }
                          = r[:denominacion].to_s
                          %p &nbsp;
                          .subtitle (Repartición Oficial)
                      - iniciadores_dependencias.each do |d|
                        .double-tab{ style: 'display: flex' }
                          = d[:denominacion].to_s
                          %p &nbsp;
                          .subtitle (Dependencia Municipal)
                      - iniciadores_persons.each do |b|
                        .double-tab{ style: 'display: flex' }
                          = type_name_initiator b
                          %p &nbsp;
                          .subtitle (Particular)

              - when '2'
                - text = if x.ref_type == 'Personal'
                  - "#{ x.ref.apellido }, #{ x.ref.nombre }"
                - else
                  - x.ref.denominacion
                - attrs = { 'data-id': x.id, 'data-tipo': x.tipo,
                            'data-idref': x.ref_id, 'data-typeref': x.ref_type }
                %tr.derivacion-tr-show{ attrs }
                  %td= to_date x.created_at
                  %td= "Derivado a #{ x.ref_type }: #{ text }"

              - when '3'
                %tr.derivacion-tr-show{ 'data-id': x.id, 'data-tipo': x.tipo }
                  %td= to_date x.created_at
                  %td
                    %span Finalizado en
                    %span= link_to "#{ x.ref_type } #{ x.ref.nro_exp }", x.ref
                    %span= x.especificacion.to_s

              - when '4' #caso para tramites finalizados pero q no terminan en expediente
                %tr.derivacion-tr-show{ 'data-id': x.id, 'data-tipo': x.tipo }
                  %td= to_date x.updated_at
                  %td
                    %span Finalizado:
                    %span= x.especificacion.to_s

              - else
                ERROR

    .panel.panel-danger
      .panel-heading Observaciones
      .panel-body
        %p.single-tab
          %span= obs.present? ? obs : '-.'
