.row
  .col-md-6#first-column
    .input-group
      = f.label :nro_fojas, { class: 'input-group-addon', id: 'basic-addon1' }
      = f.text_field :nro_fojas, { class: 'form-control',
                                   'aria-describedby': 'basic-addon1',
                                    placeholder: t('.fojas'),
                                    type: :number }
    .input-group
      = label_tag nil, 'Dictamina', { class: 'input-group-addon', id: 'basic-addon08'}
      .input-group
        = f.label :expedientes, { class: 'input-group-addon', id: 'basic-addon3' }
        = f.text_field :expedientes, { class: 'form-control',
                                       'aria-describedby': 'basic-addon3',
                                       id: 'exped_token', type: "text",
                                       data: { load: prepopulate_exps_despacho(@despacho) } }
      .input-group
        = f.label '', 'Fecha', { class: 'input-group-addon' }
        .row
          .col-md-4
            %input.form-control{ placeholder: 'Dia' }
          .col-md-4
            %input.form-control{ placeholder: 'Mes' }
          .col-md-4
            %input.form-control{ placeholder: 'Año' }
            =# f.text_field :fecha, { class: 'form-control', 'aria-describedby': 'basic-addon04', type: :date }
      .input-group
        = f.label '', t('.comisions'), { class: 'input-group-addon', id: 'basic-addon4' }
        = f.select(:comisions, options_for_select(get_options_comisions()), {}, {multiple: 'multiple', style: 'width:100%', id: 'despacho_comisions', data: { load: prepopulate_comisions(@despacho) } })
      .input-group
        = f.label '', 'Tipo de dictamen', { class: 'input-group-addon', id: 'basic-addon4' }
        = select_tag "especificacion2", options_for_select(dictamina_options2), { class: "form-control", "aria-describedby": "basic-addon0008"}
    .input-group
      = f.label :concejals, t('.concejals'), { class: "input-group-addon", id: "basic-addon5" }
      = f.select(:concejals, options_for_select(get_options_concejals()), {}, {:multiple => "multiple", :style => "width:100%", :id => "despacho_concejals", data: { load: prepopulate_concejals(@despacho) }})
    .input-group
      = f.label t('.observations'), { class: "input-group-addon", id: "basic-addon7"}
      = f.text_area :observaciones, {class: "form-control", "aria-describedby" => "basic-addon7", :placeholder => t('.observations'), type: :text }

  .col-md-6#second-column
    %ul.nav.nav-tabs{ role: 'tablist' }
      %li.active{ role: 'presentation' }
        %a{ 'data-toggle' => 'tab', 'aria-controls' => 'states-panel', href: '#states-panel', role: 'tab' }
          Estados
      %li{ role: 'presentation' }
        %a{ 'data-toggle' => 'tab', 'aria-controls' => 'associated-files', href: '#associated-files', role: 'tab' }
          Archivos asociados
    .tab-content
      #states-panel.tab-pane.active{ role: 'tabpanel' }
        .row
          .col-md-12
            %br
            .input-group
              = label_tag nil, 'Derivado a', { class: 'input-group-addon', id: 'basic-addon8' }
              = text_field_tag nil, nil, { multiple: :multiple, style: 'width: 100%', id: 'derived-states' }
            %hr
            %table.table.table-striped.table-bordered#states-table
              %thead
                %tr
                  %th= "Estado"
                  %th= "Fecha"
                  %th{ width: "1%" }= icon('fa fa-trash', class: 'fa-1x')
              %tbody
                - @despacho.estado_tramites.where(tipo: 2).each do |x|
                  - if (x.ref_type == 'Personal')
                    - text = x.ref.apellido + ", " + x.ref.nombre;
                  - else
                    - text = x.ref.denominacion;
                  %tr{ class: 'derivacion-tr', 'data-id': x.id, 'data-tipo': x.tipo, 'data-idref': x.ref_id, 'data-typeref': x.ref_type }
                    %td= "Derivado a " + x.ref_type + ": " + text
                    %td= to_date(x.created_at)
                    %td= icon 'fa fa-times fa-1x', nil, class: 'btn btn-xs remove-table-row'
              %tfoot
                %tr
                  %td
                  %td
                  %td
      #associated-files.tab-pane{ role: 'tabpanel' }
        = f.fields_for @upload, multiple: true do |file_form|
          = file_form.file_field :file, multiple: true
        %h3 Archivos cargados
        %table.table.table-bordered.upload-table
          %thead
            %tr
              %th Nombre del archivo
              %th Última modificación
              %th{ style: "width: 1%" }
          %tbody
            - @despacho.uploads.each do |up|
              %tr
                %td
                  = up.file_file_name
                %td
                  = to_date up.file_updated_at
                %td
                  = link_to '', up.file.url, class: 'btn btn-success fa fa-download', title: 'Descargar archivo', download: up.file_file_name
                  = link_to '', destroy_uploads_despacho_path(@despacho,{upload: up}), class: 'btn btn-danger fa fa-times destroy-file', title: 'Eliminar archivo', method: :post, remote: true
          %tfoot
            %tr
              %td
              %td
              %td

:javascript
  $('.destroy-file').on('ajax:success', function(){
    $(this).parent().parent().remove();
  });

  $('.destroy-file').on('ajax:error', function(){
    swal('Disculpe...', 'No fue posible eliminar el archivo', 'error')
  });
